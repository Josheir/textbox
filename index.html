<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="box.css" />
  </head>
  <body>
    <div id="demo"></div>
    <div id="box">
      <div id="relative"></div>
      <div id="cursor"></div>
    </div>

    <script>


   <script>
    <script>
      var gPositionY = 0
      var letters = []
      var gWidth = 1
      class textbox {
        constructor() {
          //let box = document.createElement("div");
          //box.className = "box-Class";
        }
      }

      let gCounter = 1
      let lettersWithoutCommas = ''
      let cursorLocation = 2.5
      let gWidthFlag = 1
      let gNum = 0
      let height = 0
      let val1 = ''
      document.addEventListener('keydown', function (e) {
        cursor.style.display = 'block'

        gPositionY++

        let key = e.key

        gCounter++


        //ADVANCING ONE LETTER AT A TIME   IS : A A A <BR>    LATER :  A A A <BR> A A A <BR>          
        //at the left hand side, time to wrap
        if (gCounter % 4 == 1) {
          //alert('32')
          height = height + 10
          relative.setAttribute('style', 'left:' + 0 + 'px')
          gCounter = 1
          gWidthFlag = 1
          gWidth = 1
          gNum = 0
          gPositionY = gPositionY + 15
          lettersWithoutCommas = lettersWithoutCommas + '<br>';
          
          /////  Writes:   <br>-
          modifypara();

          alert("here1");
          console.log("a", relative);

          /////



          console.log("B", lettersWithoutCommas);
          
          let val2 = document.getElementById("relative");
          val2.textContent = lettersWithoutCommas;

          console.log("val2",val2);


          

          //return -1
        }
        else{
          
          
        }

        nextLetter = e.key

        //  get character alert(nextLetter);
        if (nextLetter === 'Shift') {
          //alert("here");
          return -1
        }

        if (nextLetter == '0') {
          // alert(nextLetter);
          advanceArrayOneTime()
          insertCharacter(gCounter - 1, nextLetter)
        }

        if (nextLetter == '.') {
          deleteCharacter()
          return -1
        }

        // move ahead

        letters.push(nextLetter);
        console.log("let", letters);

        console.log("test", lettersWithoutCommas);
        lettersWithoutCommas = letters.join('')

        console.log("test", lettersWithoutCommas);

        if (gWidthFlag == 1) {
          gNum = gNum + 0

          gWidth = gNum.toString()
          gWidthFlag++
          //alert("1");
        } else if (gWidthFlag == 2) {
          gNum = gNum + 7

          gWidth = gNum.toString()
          gWidthFlag++
          //alert("2");
        } else {
          gNum = gNum + 7.05

          gWidth = gNum.toString()
        }

        for (i = 0; i < 32; i++) {}

        
        console.log("here3", lettersWithoutCommas)

        

        document.getElementById('relative').textContent = lettersWithoutCommas
        relativeElement = document.getElementById('cursor')
        relativeElement.setAttribute('style', 'left:' + gWidth + 'px')
        //relativeElement.setAttribute("style", 'top:' + 50 + 'px');
       
      })

      function deleteCharacter() {
        let lettersPoppedFrom = letters.pop()
        if (lettersPoppedFrom == '<br>') {
          let lettersPoppedFrom = letters.pop()
          
        }

        gCounter--
        gCounter--

        lettersWithoutCommas = letters.join('')
        document.getElementById('box').innerHTML = lettersWithoutCommas
      }

      function test() {
        document.getElementById('box').innerHTML = 'test'
      }

      function insertCharacter(indexToInsertAt, valueOfInsert) {
        //insert character into array
        //move all breaks back one with swap
        advanceArrayOneTime(indexToInsertAt)

        length = gCounter + 1

        letters.splice(1, 0, valueOfInsert)
        lettersWithoutCommas = letters.join('')

        for (i = 0; i < length; i++) {
          if (lettersWithoutCommas == '<br>') {
            // swap <br> with value right before
            swapBreak(length)
          }
        }
      }

      function swapBreak(breakPosition) {
        let holder
        lettersWithoutCommas[oneBeforeBreak] =
          lettersWithoutCommas[breakPosition - 1]

        holder = lettersWithoutCommas[oneBeforeBreak]
        lettersWithoutCommas[oneBeforeBreak] =
          lettersWithoutCommas[breakPosition]
        lettersWithoutCommas[breakPosition] = holder
      }

      function advanceArrayOneTime() {
        for (i = 0; i < gCounter - 3; i++) {
          if (i == gCounter) {
            //break;
          }
        }

        letters[i] = ''
        console.log(letters, i, gCounter)
      }

      function backSpace() {
        gCounter = 0
        gPostionX--
        gPositionY = 0
      }

      //insertUntrustedText(relative, test_text, br);

      //https://stackoverflow.com/questions/9980416/how-can-i-insert-new-line-carriage-returns-into-an-element-textcontent
      function insertUntrustedText(domElement, untrustedText, newlineStrategy) {
        domElement.innerHTML = ''
        var lines = untrustedText.replace(/\r/g, '').split('\n')
        var linesLength = lines.length
        if (newlineStrategy === 'br') {
          for (var i = 0; i < linesLength; i++) {
            domElement.appendChild(document.createTextNode(lines[i]))
            domElement.appendChild(document.createElement('br'))
            alert('br')
          }
        } else {
          for (var i = 0; i < linesLength; i++) {
            var lineElement = document.createElement(newlineStrategy)
            lineElement.textContent = lines[i]
            domElement.appendChild(lineElement)
          }
        }
      }

      // a a a <br>-    - 7    a a a <br> a a a <br>-      - 14
      function modifypara() {
        let p;
        p = document.getElementById("relative");
        
        p.appendChild(document.createElement("br"));
       p.appendChild(document.createTextNode("jj"));
        //document.getElementById("relative").appendChild(p);
        //let p2 = document.getElementById("relative");


        alert("check here");
        
        
        return(1);
      }
    </script>
  </body>
</html>
